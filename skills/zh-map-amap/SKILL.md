---
name: zh-map-amap
description: 中国地图POI搜索工具（高德地图API）。专门用于中国境内地点查询，查找北京/上海/深圳等城市的餐厅、咖啡馆、加油站、酒店、银行、超市、药店、医院、学校、商场、理发店、美容院等兴趣点。支持周边搜索、关键词搜索、距离计算。适用于"北京/上海附近有什么XX"、"三里屯哪里有YY"、"望京XX在哪"等中国地点查询。使用高德地图API，覆盖中国全国POI数据。注意：国外地点请用goplaces或local-places技能（Google Places API）
---

# map-poi - 地图POI查询技能

## Purpose
通过高德地图API查询指定位置附近的POI（兴趣点），如餐厅、理发店、便利店等。

**何时使用**：
- 用户询问"附近有什么XX"
- 需要查找特定地址周边的商家
- 需要计算两地之间的距离

## Inputs

JSON格式：
```json
{
  "address": "北京市朝阳区望京北路1号中国数码港大厦",  // 必填：起始地址
  "keyword": "理发店",                                    // 必填：搜索关键词（餐厅/理发店/便利店等）
  "radius": 1000,                                        // 可选：搜索半径（米），默认1000
  "city": "北京",                                        // 可选：城市名称，默认从地址提取
  "limit": 10                                            // 可选：返回结果数量，默认10
}
```

或简化文本格式：
```
"北京市朝阳区望京北路1号 附近的 理发店"
```

## Output

返回JSON格式的POI列表：
```json
{
  "origin_address": "北京市朝阳区望京北路1号中国数码港大厦",
  "origin_location": "116.48,40.00",
  "keyword": "理发店",
  "results": [
    {
      "name": "木北造型(望京店)",
      "address": "北京市朝阳区望京SOHO T1座",
      "distance": 520,
      "phone": "010-12345678",
      "rating": 4.5,
      "price_level": "$$"
    }
  ],
  "total": 8
}
```

## Steps

### 1. 解析输入
- 提取地址、关键词、半径等参数
- 如果是文本格式，智能分割

### 2. 获取API密钥
- 优先使用高德地图API（免费额度高）
- 从环境变量读取 `AMAP_API_KEY`
- 如果未配置，引导用户申请

### 3. 地理编码
- 调用高德地图地理编码API
- 将地址转换为经纬度坐标

### 4. POI检索
- 调用高德地图周边搜索API
- 参数：location（经纬度）、keyword、radius、limit

### 5. 结果格式化
- 提取关键信息：名称、地址、距离、电话
- 按距离排序
- 返回用户友好的摘要

## Guardrails

- **API密钥缺失**：提示用户申请高德API Key（免费）
- **地址无效**：提示用户提供更详细的地址
- **无结果**：建议扩大搜索半径或更换关键词
- **限流保护**：单次请求不超过20个结果
- **隐私保护**：不记录用户的具体地址信息

## API申请指南

高德地图API申请（推荐）：
1. 访问：https://console.amap.com/dev/key/app
2. 注册/登录高德开放平台
3. 创建应用 → 添加Key（Web服务）
4. 复制Key，配置到项目：

   **方式1（推荐）**：在对话中让 AI 帮你配置
   ```
   "请帮我配置高德地图 API Key: your_key_here"
   ```

   **方式2**：手动编辑项目 .env 文件
   ```bash
   # 在项目根目录的 .env 文件中添加：
   AMAP_API_KEY=your_key_here

   # 重启服务
   npm run restart
   ```

5. 免费额度：每日30万次调用

⚠️ **注意**：不要配置到 ~/.zshrc，因为服务运行时不会加载 shell 配置文件

## Example Usage

```javascript
// 示例1：查找附近理发店
{
  "address": "北京市朝阳区望京北路1号中国数码港大厦",
  "keyword": "理发店",
  "radius": 1000
}

// 示例2：查找附近餐厅（2公里范围）
{
  "address": "上海市浦东新区陆家嘴环路1000号",
  "keyword": "川菜",
  "radius": 2000,
  "limit": 15
}
```

## Error Handling

- 401 Unauthorized → API Key无效
- 429 Too Many Requests → 超出配额限制
- 地理编码失败 → 地址不够详细
- 无POI结果 → 扩大范围或换关键词
